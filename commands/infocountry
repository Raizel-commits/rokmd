export const name = "infocountry";
export const description = "Get detailed information about a country";

export async function execute(sock, msg) {
    const jid = msg.key.remoteJid;
    const args = msg.message?.conversation?.split(" ") || [];
    
    if (!args[1]) {
        return await sock.sendMessage(jid, {
            text: "ğš„ğšœğšŠğšğš: .ğšŒğš˜ğšğš—ğšğš›ğš¢ğš’ğš—ğšğš˜ğšœ ğšŒğš˜ğšğš—ğšğš›ğš¢_ğš—ğšŠğš–ğš"
        });
    }

    const countryName = args.slice(1).join(" ");
    
    try {
        const apiUrl = `https://api.siputzx.my.id/api/tools/countryInfo?name=${encodeURIComponent(countryName)}`;
        const res = await fetch(apiUrl);
        const data = await res.json();

        if (!data?.status || !data.data) {
            return await sock.sendMessage(jid, {
                text: `ğ™½ğš˜ ğš’ğš—ğšğš˜ğš›ğš–ğšŠğšğš’ğš˜ğš— ğšğš˜ğšğš—ğš ğšğš˜ğš› "${countryName}"`
            });
        }

        const info = data.data;
        const neighborsText = info.neighbors?.length > 0 
            ? info.neighbors.map(n => n.name).join(", ") 
            : "None";

        const caption = `ğŸŒ *${info.name.common || countryName}*
        
ğ™²ğšŠğš™ğš’ğšğšŠğš•: ${info.capital || "N/A"}
ğ™²ğš˜ğš—ğšğš’ğš—ğšğš—ğš: ${info.continent?.name || "N/A"} ${info.continent?.emoji || ""}
ğ™¿ğš‘ğš˜ğš—ğš ğ™²ğš˜ğšğš: ${info.phoneCode || "N/A"}
ğ™°ğš›ğšğšŠ: ${info.area?.squareKilometers || "N/A"} kmÂ²
ğ™²ğšğš›ğš›ğšğš—ğšŒğš¢: ${info.currency || "N/A"}
ğ™»ğšŠğš—ğšğšğšŠğšğšğšœ: ${info.languages?.native?.join(", ") || "N/A"}
ğ™½ğšğš’ğšğš‘ğš‹ğš˜ğš›ğšœ: ${neighborsText}
ğ™¸ğš‚ğ™¾: ${info.isoCode?.alpha2 || ""}/${info.isoCode?.alpha3 || ""}
ğšƒğ™»ğ™³: ${info.internetTLD || "N/A"}`;

        await sock.sendMessage(jid, {
            image: { url: info.flag },
            caption: caption
        });

    } catch (error) {
        await sock.sendMessage(jid, {
            text: "ğ™´ğš›ğš›ğš˜ğš› ğšğšğšğšŒğš‘ğš’ğš—ğš ğšŒğš˜ğšğš—ğšğš›ğš¢ ğš’ğš—ğšğš˜."
        });
    }
}
