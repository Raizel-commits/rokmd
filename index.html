<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROK XD MiniBot • Dashboard</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0b0b0d;
  --card:#141417;
  --border:#232327;
  --violet:#8b5cf6;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --hover:#1e1e26;
}

*{box-sizing:border-box;margin:0;padding:0;font-family:"JetBrains Mono", monospace;}

body{
  background:linear-gradient(180deg,#050506,#0b0b0d);
  color:var(--text);
}

/* ===== HEADER ===== */
.header{
  display:flex;justify-content:space-between;align-items:center;
  padding:16px 18px;border-bottom:1px solid var(--border);
  position:sticky;top:0;background:var(--bg);z-index:10;
}
.menu-btn{font-size:22px;cursor:pointer;color:var(--violet);}

/* ===== SIDE MENU ===== */
.side-menu{
  position:fixed;top:0;left:-260px;width:260px;height:100%;
  background:var(--bg);border-right:1px solid var(--border);
  transition:.3s;z-index:1000;
}
.side-menu.active{left:0;}
.menu-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.6);
  display:none;z-index:900;
}
.menu-overlay.active{display:block;}
.side-header{padding:16px;border-bottom:1px solid var(--border);}
.side-links a{
  display:flex;gap:12px;padding:14px;color:#e5e7eb;
  text-decoration:none;transition:.2s;
}
.side-links a.active,
.side-links a:hover{background:var(--hover);color:var(--violet);}

/* ===== CARDS ===== */
.container{padding:20px;display:flex;justify-content:center;flex-wrap:wrap;gap:20px;}
.card{
  max-width:360px;width:100%;background:var(--card);
  border:1px solid var(--border);border-radius:16px;
  padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.6);
  text-align:center;
  transition:transform .3s, box-shadow .3s;
}
.card:hover{
  transform: translateY(-5px);
  box-shadow:0 15px 40px rgba(0,0,0,.8);
}

/* ===== BUTTONS ===== */
.btn{
  width:100%;margin-top:12px;padding:14px;
  background:linear-gradient(45deg,#8b5cf6,#4c1d95);
  color:#fff;border:none;border-radius:12px;
  font-size:15px;font-weight:600;cursor:pointer;
  transition:.3s;
}
.btn:hover{transform:scale(1.05);box-shadow:0 6px 15px rgba(139,92,246,.6);}
.btn.disabled{opacity:.5;pointer-events:none;}

/* ===== OPTIONS PANEL ===== */
.options-panel{display:flex;flex-direction:column;gap:12px;margin-top:16px;text-align:center;}
.options-panel h3{margin:0 0 12px 0;color:var(--violet);}

/* ===== FLOAT MESSAGE ===== */
.toast{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:var(--card);border:1px solid var(--border);
  padding:18px 26px;border-radius:16px;
  font-weight:bold;z-index:9999;
}

/* ===== BOTTOM ===== */
.bottom{
  position:fixed;bottom:0;left:0;right:0;
  background:var(--bg);border-top:1px solid var(--border);
  display:flex;justify-content:space-around;padding:10px 0;
}
.bottom a{text-decoration:none;color:var(--muted);}
.bottom a.active{color:var(--violet);}

/* ===== TABS ===== */
.tab{display:none;}
.tab.active{display:block;}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
  <h1>ROK XD MiniBot</h1>
  <div class="menu-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i></div>
</div>

<!-- MENU -->
<div id="sideMenu" class="side-menu">
  <div class="side-header">ROK XD</div>
  <div class="side-links">
    <a href="#" onclick="showTab('bot')" class="active"><i class="fas fa-robot"></i> Bot</a>
    <a href="#" onclick="showTab('panel')"><i class="fas fa-shopping-cart"></i> Achat</a>
    <a href="#" onclick="showTab('coins')"><i class="fas fa-coins"></i> Coins</a>
    <a href="#" onclick="showTab('pair')"><i class="fas fa-link"></i> Pair</a>
    <a href="#" onclick="showTab('qr')"><i class="fas fa-qrcode"></i> QR</a>
    <a href="/logout"><i class="fas fa-power-off"></i> Logout</a>
  </div>
</div>
<div id="menuOverlay" class="menu-overlay" onclick="toggleMenu()"></div>

<!-- CONTENT -->
<div class="container">

  <!-- BOT TAB -->
  <div id="tab-bot" class="tab active">
    <div class="card">
      <div class="avatar">
        <img src="https://files.catbox.moe/36ywf8.jpeg">
      </div>
      <h2>Bot Management</h2>
      <p id="botTimer">Bot inactif</p>
      <p>Coins : <b id="coins">0</b></p>
      <a href="/pair" id="pairBtn" class="btn">Pair Bot</a>
      <a href="/qrpage" id="qrBtn" class="btn">QR Code</a>
      <button id="watchAdBtn" class="btn">Watch Ad (+1 coin)</button>
    </div>
  </div>

  <!-- ACHAT BOT TAB -->
  <div id="tab-panel" class="tab">
    <div class="card">
      <h2>Achat Bot</h2>
      <div class="options-panel">
        <button onclick="buyBot('24')">24h - 500 XAF</button>
        <button onclick="buyBot('48')">48h - 1000 XAF</button>
        <button onclick="buyBot('72')">72h - 1500 XAF</button>
      </div>
    </div>
  </div>

  <!-- COINS TAB -->
  <div id="tab-coins" class="tab">
    <div class="card">
      <h2>Achat Coins</h2>
      <div class="options-panel">
        <button onclick="buyCoins('50')">50 coins - 500 XAF</button>
        <button onclick="buyCoins('100')">100 coins - 1000 XAF</button>
        <button onclick="buyCoins('250')">250 coins - 2000 XAF</button>
      </div>
    </div>
  </div>

</div>

<!-- BOTTOM -->
<div class="bottom">
  <a href="#" onclick="showTab('bot')" class="active"><i class="fas fa-robot"></i></a>
  <a href="#" onclick="showTab('panel')"><i class="fas fa-shopping-cart"></i></a>
  <a href="#" onclick="showTab('coins')"><i class="fas fa-coins"></i></a>
</div>

<script>
let botTimeRemaining=0,userCoins=0,timerInterval;

const coinsEl=document.getElementById('coins');
const botTimer=document.getElementById('botTimer');
const pairBtn=document.getElementById('pairBtn');
const qrBtn=document.getElementById('qrBtn');
const watchAdBtn=document.getElementById('watchAdBtn');

const sideMenu=document.getElementById('sideMenu');
const menuOverlay=document.getElementById('menuOverlay');

function toggleMenu(){
  sideMenu.classList.toggle('active');
  menuOverlay.classList.toggle('active');
}

function toast(msg){
  const t=document.createElement('div');
  t.className='toast';t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),2500);
}

function updateTimer(){
  if(timerInterval) clearInterval(timerInterval);
  if(botTimeRemaining<=0){
    botTimer.textContent="Bot inactif";
    pairBtn.classList.add('disabled');
    qrBtn.classList.add('disabled');
    return;
  }
  pairBtn.classList.remove('disabled');
  qrBtn.classList.remove('disabled');
  timerInterval=setInterval(()=>{
    if(botTimeRemaining<=0){updateTimer();return;}
    const h=Math.floor(botTimeRemaining/3600000);
    const m=Math.floor((botTimeRemaining%3600000)/60000);
    const s=Math.floor((botTimeRemaining%60000)/1000);
    botTimer.textContent=`Actif : ${h}h ${m}m ${s}s`;
    botTimeRemaining-=1000;
  },1000);
}

async function loadStatus(){
  const r=await fetch('/coins');
  const d=await r.json();
  if(d.error){location.href='/login';return;}
  userCoins=d.coins||0;
  botTimeRemaining=d.botActiveRemaining||0;
  coinsEl.textContent=userCoins;
  updateTimer();
}

watchAdBtn.onclick=async()=>{
  const r=await fetch('/watch-ad');
  const d=await r.json();
  if(d.allowed){
    toast("Regardez la pub…");
    const complete = await fetch('/watch-ad/complete',{method:'POST'});
    const result = await complete.json();
    if(result.success){
      userCoins=result.coins;
      coinsEl.textContent=userCoins;
      toast("+1 coin ajouté !");
    }
  } else toast("Limite quotidienne atteinte");
};

async function buyBot(option){
  try{
    const r=await fetch('/pay-bot',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({amount:option*20})});
    const d=await r.json();
    if(d.error) return toast(d.error);
    window.open(d.url,'_blank');
  }catch(e){toast("Erreur paiement");console.error(e);}
}

async function buyCoins(option){
  try{
    const r=await fetch('/pay-bot',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({amount:option*10})});
    const d=await r.json();
    if(d.error) return toast(d.error);
    window.open(d.url,'_blank');
  }catch(e){toast("Erreur paiement");console.error(e);}
}

// ===== TABS =====
function showTab(tab){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('tab-'+tab).classList.add('active');
  document.querySelectorAll('.bottom a').forEach(a=>a.classList.remove('active'));
  document.querySelectorAll('.side-links a').forEach(a=>a.classList.remove('active'));
  document.querySelector(`.bottom a[onclick*="${tab}"]`)?.classList.add('active');
  document.querySelector(`.side-links a[onclick*="${tab}"]`)?.classList.add('active');
}

loadStatus();
</script>
</body>
</html>
