<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROK XD • WhatsApp Bot</title>
<style>
:root{
  --bg-1:#020617;
  --bg-2:#0f172a;
  --neon:#38bdf8;
  --glass-border:rgba(56,189,248,0.22);
  --muted:rgba(255,255,255,0.45);
  --card-w:380px;
}
*{box-sizing:border-box;}
html,body{
  height:100%;
  margin:0;
  font-family:"Inter",system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  background: radial-gradient(1200px 600px at 10% 10%, rgba(56,189,248,0.03), transparent),
              radial-gradient(900px 500px at 90% 85%, rgba(56,189,248,0.02), transparent),
              linear-gradient(180deg,var(--bg-1),var(--bg-2));
  color:#dfffe6;
  overflow:hidden;
}
.stage{
  position:relative;
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:36px;
}
.glass-card{
  width:var(--card-w);
  max-width:92vw;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius:18px;
  padding:22px;
  box-shadow:0 10px 40px rgba(0,0,0,0.7),0 0 40px rgba(56,189,248,0.05) inset;
  backdrop-filter: blur(10px) saturate(140%);
  border:1px solid var(--glass-border);
  text-align:center;
  position:relative;
}
.card-header h1{
  font-family:"JetBrains Mono", monospace;
  font-size:24px;
  margin:0;
  color:var(--neon);
  text-transform:uppercase;
  text-shadow:0 0 18px rgba(56,189,248,0.22);
}
.card-header .small-url{
  font-size:12px;
  color:var(--muted);
  margin-top:6px;
}
.btn{
  display:block;
  width:100%;
  padding:12px;
  margin:10px 0;
  font-size:16px;
  font-weight:bold;
  color:#020617;
  background:var(--neon);
  border:none;
  border-radius:6px;
  text-decoration:none;
  cursor:pointer;
  text-align:center;
}
.btn:hover{opacity:0.9;}
.social-icons{
  display:flex;
  justify-content:center;
  gap:15px;
  margin-top:15px;
}
.social-icons a{
  display:flex;
  align-items:center;
  justify-content:center;
  width:40px;
  height:40px;
  border-radius:50%;
  background:var(--neon);
  color:#020617;
  text-decoration:none;
  font-weight:bold;
  font-size:20px;
}
.credits{font-size:12px;color:var(--muted);margin-top:20px;}
.avatar{margin-bottom:10px;}
.avatar img{width:60px;height:60px;border-radius:50%;border:2px solid var(--neon);}
.coins-display{display:flex;justify-content:center;align-items:center;gap:8px;margin-bottom:10px;font-weight:bold;}
.coins-display button{width:auto;padding:4px 8px;font-size:14px;}
.timer{margin-top:8px;font-size:14px;color:#38bdf8;}
.menu-btn{position:absolute;top:12px;right:12px;width:30px;height:22px;cursor:pointer;display:flex;flex-direction:column;justify-content:space-between;}
.menu-btn span{display:block;height:4px;width:100%;background:var(--neon);border-radius:2px;transition:0.3s;}
.menu-content{position:absolute;top:50px;right:0;width:220px;background:linear-gradient(180deg, rgba(0,0,0,0.3), rgba(0,0,0,0.1));border:1px solid var(--glass-border);border-radius:10px;padding:10px;display:none;flex-direction:column;gap:10px;}
.menu-content button{background:none;color:var(--neon);border:none;text-align:left;cursor:pointer;font-weight:bold;}
.menu-content button:hover{text-decoration:underline;}
.result-message{margin-top:10px;font-weight:bold;text-align:center;}
</style>
</head>
<body>
<main class="stage">
<section class="glass-card">
  <!-- Hamburger Menu -->
  <div class="menu-btn" id="menuBtn">
    <span></span>
    <span></span>
    <span></span>
  </div>
  <div class="menu-content" id="menuContent">
    <button id="copyLinkBtn">Copier mon lien de parrainage</button>
    <button onclick="window.open('https://wa.me/237699777530','_blank')">Contacter RAIZEL</button>
    <button onclick="window.open('https://wa.me/237673941535','_blank')">Contacter KNUT</button>
    <button id="helpBtn">Help</button>
  </div>

  <!-- Avatar -->
  <div class="avatar">
    <img src="https://files.catbox.moe/36ywf8.jpeg" alt="Avatar">
  </div>

  <header class="card-header">
    <h1>ROK XD</h1>
    <div class="small-url">WhatsApp Bot</div>
  </header>

  <!-- Coins -->
  <div class="coins-display">
    Coins : <span id="coins">0</span>
    <button id="addCoinsBtn">+</button>
  </div>

  <!-- Timer Bot -->
  <div class="timer" id="botTimer">Bot inactif</div>

  <!-- Achat durée -->
  <div>
    <button class="btn" onclick="buyBot(24)">Acheter 24h (20 coins)</button>
    <button class="btn" onclick="buyBot(48)">Acheter 48h (40 coins)</button>
    <button class="btn" onclick="buyBot(72)">Acheter 72h (60 coins)</button>
  </div>

  <!-- Boutons pair & qr -->
  <a href="pair" class="btn" id="pairBtn">Pairing Code</a>
  <a href="qrpage" class="btn" id="qrBtn">QR Code</a>

  <div class="result-message" id="resultMsg"></div>

  <div class="social-icons">
    <a href="https://t.me/devraizel" target="_blank">T</a>
    <a href="https://wa.me/237673941535" target="_blank">W</a>
  </div>
  <div class="credits">Développé par RAIZEL & KNUT</div>
</section>
</main>

<script>
const menuBtn = document.getElementById("menuBtn");
const menuContent = document.getElementById("menuContent");
menuBtn.onclick = ()=>{menuContent.style.display = menuContent.style.display==='flex'?'none':'flex';}

// Coins et timer
const coinsEl = document.getElementById("coins");
const resultMsg = document.getElementById("resultMsg");
const botTimer = document.getElementById("botTimer");

let botTimeRemaining = 0;

async function loadCoins(){
  const res = await fetch("/coins");
  const data = await res.json();
  coinsEl.textContent = data.coins;
  botTimeRemaining = data.botActiveRemaining || 0;
  updateTimer();
}
loadCoins();

function updateTimer(){
  if(botTimeRemaining<=0){ botTimer.textContent="Bot inactif"; return; }
  const interval = setInterval(()=>{
    if(botTimeRemaining<=0){ botTimer.textContent="Bot inactif"; clearInterval(interval); return; }
    botTimeRemaining-=1000;
    const h = Math.floor(botTimeRemaining/3600000);
    const m = Math.floor((botTimeRemaining%3600000)/60000);
    const s = Math.floor((botTimeRemaining%60000)/1000);
    botTimer.textContent = `Bot actif : ${h}h ${m}m ${s}s`;
  },1000);
}

// Ajouter coins
document.getElementById("addCoinsBtn").onclick = async ()=>{
  const amount = prompt("Combien de coins voulez-vous ajouter ?");
  if(!amount) return;
  const res = await fetch("/add-coins",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount})});
  const data = await res.json();
  if(data.error) resultMsg.innerHTML=`<span style="color:#ef4444">${data.error}</span>`;
  else { resultMsg.innerHTML=`<span style="color:#38bdf8">${data.status}</span>`; loadCoins(); }
}

// Parrainage
const copyLinkBtn = document.getElementById("copyLinkBtn");
copyLinkBtn.onclick = ()=>{
  const link = `${window.location.origin}/register?ref=${encodeURIComponent(prompt('Entrez votre nom d’utilisateur pour générer le lien'))}`;
  navigator.clipboard.writeText(link);
  resultMsg.innerHTML=`<span style="color:#38bdf8">Lien copié !</span>`;
}

// Help
document.getElementById("helpBtn").onclick = ()=>{
  resultMsg.innerHTML = `<span style="color:#38bdf8">
  1️⃣ Pour accéder à Pairing ou QR Code vous devez avoir le bot actif.<br>
  2️⃣ Chaque nouvel utilisateur inscrit via votre lien de parrainage vous donne +5 coins.<br>
  3️⃣ Vous pouvez ajouter des coins via le bouton "+" (paiement Money Fusion simulé).<br>
  4️⃣ Cliquez sur Pairing Code ou QR Code pour déployer, coins seront vérifiés.<br>
  5️⃣ Achetez une durée pour activer le bot.<br>
  6️⃣ Contactez RAIZEL ou KNUT si besoin.
  </span>`;
}

// Vérification coins avant pair/qr
document.getElementById("pairBtn").onclick = async (e)=>{
  e.preventDefault();
  const res = await fetch("/coins"); const data = await res.json();
  if((data.botActiveRemaining||0)<=0){ resultMsg.innerHTML='<span style="color:#ef4444">Bot inactif, achetez une durée</span>'; return; }
  window.location.href="pair";
}
document.getElementById("qrBtn").onclick = async (e)=>{
  e.preventDefault();
  const res = await fetch("/coins"); const data = await res.json();
  if((data.botActiveRemaining||0)<=0){ resultMsg.innerHTML='<span style="color:#ef4444">Bot inactif, achetez une durée</span>'; return; }
  window.location.href="qrpage";
}

// Acheter durée bot
async function buyBot(hours){
  const confirmBuy = confirm(`Confirmez l'achat de ${hours}h pour activer votre bot ?`);
  if(!confirmBuy) return;
  const res = await fetch("/buy-bot",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({duration:hours})});
  const data = await res.json();
  if(data.error) resultMsg.innerHTML=`<span style="color:#ef4444">${data.error}</span>`;
  else{
    resultMsg.innerHTML=`<span style="color:#38bdf8">✅ ${data.status}</span>`;
    botTimeRemaining = data.expires - Date.now();
    loadCoins();
  }
}
</script>
</body>
</html>
