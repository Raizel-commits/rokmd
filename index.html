<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROK XD â€¢ Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --bg-1:#020617;
  --bg-2:#0f172a;
  --neon:#38bdf8;
  --glass-border:rgba(56,189,248,0.22);
  --muted:rgba(255,255,255,0.45);
  --btn-bg:#38bdf8;
}
*{box-sizing:border-box}
html,body{
  margin:0;height:100%;
  font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
  background:linear-gradient(180deg,var(--bg-1),var(--bg-2));
  color:#e5e7eb;
}
.stage{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:24px;
}
.glass-card{
  width:380px;max-width:95vw;
  background:rgba(255,255,255,.03);
  border:1px solid var(--glass-border);
  border-radius:18px;
  padding:20px;
  text-align:center;
  backdrop-filter:blur(14px);
}
h1{
  color:var(--neon);
  font-family:"JetBrains Mono",monospace;
  font-size:20px;
  margin:0 0 6px;
}
.avatar img{
  width:60px;height:60px;border-radius:50%;
  border:2px solid var(--neon);
  box-shadow:0 0 12px var(--neon);
  margin:12px 0;
}
.timer,.coins{
  font-family:"JetBrains Mono",monospace;
  margin:6px 0;
  color:var(--neon);
}
.store-card{
  border:1px solid var(--glass-border);
  border-radius:12px;
  padding:10px;
  margin:8px 0;
}
.select-pay{
  width:100%;
  margin-top:6px;
  padding:6px;
  background:rgba(255,255,255,.05);
  color:#fff;
  border:1px solid var(--glass-border);
  border-radius:8px;
}
.btn{
  display:flex;gap:8px;
  justify-content:center;align-items:center;
  margin:6px 0;
  padding:10px;
  border-radius:20px;
  background:var(--btn-bg);
  color:#000;
  font-weight:bold;
  text-decoration:none;
}
.btn.disabled{opacity:.5;pointer-events:none}
.hamburger{
  position:fixed;top:14px;left:14px;
  color:var(--neon);
  font-size:22px;
  cursor:pointer;
}
.side-menu{
  position:fixed;top:0;left:-260px;
  width:260px;height:100%;
  background:#020617;
  border-right:1px solid var(--glass-border);
  transition:.3s;
  z-index:1000;
}
.side-menu.active{left:0}
.side-links a{
  display:flex;gap:10px;
  padding:12px;color:#e5e7eb;
  text-decoration:none;
}
.menu-overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:none;z-index:900;
}
.menu-overlay.active{display:block}
</style>
</head>

<body>

<div class="hamburger" onclick="toggleMenu()"><i class="fas fa-bars"></i></div>

<div id="sideMenu" class="side-menu">
  <div style="padding:16px;border-bottom:1px solid var(--glass-border)">
    <strong style="color:var(--neon)">ROK XD</strong>
    <div id="menuUser" style="font-size:12px;color:var(--muted)">User</div>
  </div>
  <div class="side-links">
    <a href="/"><i class="fas fa-home"></i> Accueil</a>
    <a href="/pair"><i class="fas fa-link"></i> Pairing</a>
    <a href="/qrpage"><i class="fas fa-qrcode"></i> QR</a>
    <a id="menuReferral"><i class="fas fa-user-plus"></i> Parrainage</a>
    <a href="/logout"><i class="fas fa-power-off"></i> DÃ©connexion</a>
  </div>
</div>

<div id="menuOverlay" class="menu-overlay" onclick="toggleMenu()"></div>

<main class="stage">
<section class="glass-card">

<h1>ROK XD â€¢ Dashboard</h1>

<div class="avatar">
  <img src="https://files.catbox.moe/36ywf8.jpeg">
</div>

<div id="botTimer" class="timer">Bot inactif</div>
<div class="coins">Coins : <span id="coins">0</span></div>

<div class="store-card">
  <strong>24 heures</strong><br>
  20 coins / 800 FCFA
  <select class="select-pay" onchange="selectPayment(this,24)">
    <option value="">--Payer avec--</option>
    <option value="coins">Coins</option>
    <option value="fcfa">FCFA</option>
  </select>
</div>

<div class="store-card">
  <strong>48 heures</strong><br>
  40 coins / 1600 FCFA
  <select class="select-pay" onchange="selectPayment(this,48)">
    <option value="">--Payer avec--</option>
    <option value="coins">Coins</option>
    <option value="fcfa">FCFA</option>
  </select>
</div>

<div class="store-card">
  <strong>72 heures</strong><br>
  60 coins / 2400 FCFA
  <select class="select-pay" onchange="selectPayment(this,72)">
    <option value="">--Payer avec--</option>
    <option value="coins">Coins</option>
    <option value="fcfa">FCFA</option>
  </select>
</div>

<a id="pairBtn" class="btn" href="/pair"><i class="fas fa-link"></i> Pairing</a>
<a id="qrBtn" class="btn" href="/qrpage"><i class="fas fa-qrcode"></i> QR Code</a>

<button id="watchAdBtn" class="btn"><i class="fas fa-video"></i> Watch Ad</button>

</section>
</main>

<script>
let botTimeRemaining=0,timerInterval;
const coinsEl=document.getElementById('coins');
const botTimer=document.getElementById('botTimer');
const pairBtn=document.getElementById('pairBtn');
const qrBtn=document.getElementById('qrBtn');
const menuUser=document.getElementById('menuUser');
const menuReferral=document.getElementById('menuReferral');

function toggleMenu(){
  sideMenu.classList.toggle('active');
  menuOverlay.classList.toggle('active');
}

async function loadStatus(){
  const r=await fetch('/coins',{credentials:'include'});
  const d=await r.json();
  if(d.error){location.href='/login';return;}
  coinsEl.textContent=d.coins;
  menuUser.textContent='ðŸ‘¤ '+d.username;
  menuReferral.href='/referral?user='+d.username;
  botTimeRemaining=d.botActiveRemaining||0;
  updateTimer();
}

function updateTimer(){
  clearInterval(timerInterval);
  if(botTimeRemaining<=0){
    botTimer.textContent='Bot inactif';
    pairBtn.classList.add('disabled');
    qrBtn.classList.add('disabled');
    return;
  }
  pairBtn.classList.remove('disabled');
  qrBtn.classList.remove('disabled');
  timerInterval=setInterval(()=>{
    if(botTimeRemaining<=0){clearInterval(timerInterval);return;}
    const h=Math.floor(botTimeRemaining/3600000);
    const m=Math.floor(botTimeRemaining%3600000/60000);
    const s=Math.floor(botTimeRemaining%60000/1000);
    botTimer.textContent=`Bot actif : ${h}h ${m}m ${s}s`;
    botTimeRemaining-=1000;
  },1000);
}

async function selectPayment(sel,h){
  if(sel.value==='coins'){
    await fetch('/buy-bot',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      credentials:'include',
      body:JSON.stringify({duration:h})
    });
    loadStatus();
  }
  if(sel.value==='fcfa'){
    const amount={24:800,48:1600,72:2400}[h];
    const r=await fetch('/pay-bot',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      credentials:'include',
      body:JSON.stringify({amount})
    });
    const d=await r.json();
    if(d.url) location.href=d.url;
  }
  sel.value='';
}

document.getElementById('watchAdBtn').onclick=async()=>{
  await fetch('/watch-ad',{credentials:'include'});
  await fetch('/watch-ad/complete',{method:'POST',credentials:'include'});
  loadStatus();
};

loadStatus();
</script>
</body>
</html>
