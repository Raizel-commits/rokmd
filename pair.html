<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RAIZEL XMD ‚Ä¢ Gestion Bots</title>
<style>
:root{
 --glass:rgba(255,255,255,0.10);
 --primary:#1db954;
 --secondary:#9333ea;
 --text:#fff;
 --muted:#b3b3b3;
}
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;margin:0;padding:0;}
body{background:#000;color:var(--text);overflow-x:hidden;}
.card{background:var(--glass);backdrop-filter:blur(20px);border-radius:22px;padding:20px;margin:15px auto;border:1px solid rgba(255,255,255,.15);max-width:500px;box-shadow:0 0 40px rgba(0,0,0,.4);}
label{font-size:12px;color:var(--muted);}
input{width:100%;padding:14px;border-radius:14px;border:none;background:#00000055;color:white;margin:8px 0 14px;}
.btn{display:block;width:100%;padding:15px;margin-top:8px;border-radius:16px;background:linear-gradient(135deg,var(--primary),#22c55e);color:#000;font-weight:800;border:none;text-align:center;transition:.25s;cursor:pointer;}
.btn:active{transform:scale(.97);}
.result{margin-top:10px;font-weight:700;text-align:center;}
.bot-list{margin-top:20px;}
.bot-item{background:#11111155;border-radius:12px;padding:10px;margin-bottom:10px;}
.bot-item p{margin:4px 0;font-size:14px;}
.code{font-size:20px;letter-spacing:4px;color:#22c55e;font-weight:700;}
</style>
</head>
<body>

<div class="card">
  <h2>G√©n√©rer Pairing</h2>
  <label>Num√©ro WhatsApp</label>
  <input id="phone" placeholder="2376XXXXXXX">
  <label>Nom du bot</label>
  <input id="user" placeholder="raizelbot">
  <label>Pr√©fixe des commandes</label>
  <input id="prefix" placeholder="!">
  <button class="btn" id="gen">G√âN√âRER</button>
  <div class="result" id="res"></div>
</div>

<div class="card bot-list">
  <h2>Bots Connect√©s</h2>
  <div id="bots"></div>
</div>

<script>
// G√©n√©ration Pairing
document.getElementById("gen").onclick = async () => {
  const phone = document.getElementById("phone").value.trim();
  const user = document.getElementById("user").value.trim();
  const prefix = document.getElementById("prefix").value.trim() || "!";
  const res = document.getElementById("res");

  if(!phone){ res.innerHTML="‚ùå Num√©ro manquant"; return; }
  res.innerHTML = "‚è≥ G√©n√©ration...";

  try{
    const r = await fetch(`/code?number=${phone}&user=${encodeURIComponent(user)}&prefix=${encodeURIComponent(prefix)}`);
    const d = await r.json();
    if(d.code){
      res.innerHTML = `<div class="code">${d.code}</div><p>Pr√©fix: <strong>${prefix}</strong></p>`;
      loadBots(); // rafra√Æchit la liste
    } else if(d.status){
      res.innerHTML = `<div class="code">‚úÖ D√©j√† connect√©</div><p>Pr√©fix: <strong>${prefix}</strong></p>`;
      loadBots();
    } else {
      res.innerHTML = "‚ùå Erreur";
    }
  } catch{
    res.innerHTML = "‚ùå Serveur injoignable";
  }
};

// Liste des bots connect√©s
async function loadBots(){
  const container = document.getElementById("bots");
  container.innerHTML = "‚è≥ Chargement...";
  try{
    const r = await fetch('/list-bots'); // route √† cr√©er dans server.js
    const data = await r.json();
    if(data.bots && data.bots.length){
      container.innerHTML = "";
      data.bots.forEach(b => {
        const div = document.createElement("div");
        div.className = "bot-item";
        div.innerHTML = `<p>üì± Num√©ro: <strong>${b.number}</strong></p>
                         <p>ü§ñ Bot: <strong>${b.user}</strong></p>
                         <p>‚ö° Pr√©fix: <strong>${b.prefix}</strong></p>
                         <p>üÜî Code: <span class="code">${b.code||"‚ùå Non g√©n√©r√©"}</span></p>`;
        container.appendChild(div);
      });
    } else {
      container.innerHTML = "Aucun bot connect√©";
    }
  } catch{
    container.innerHTML = "‚ùå Impossible de charger";
  }
}

loadBots();
</script>

</body>
</html>
