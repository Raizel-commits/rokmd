<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROK XD • Login</title>
<style>
:root{
  --bg-1:#020617; --bg-2:#0f172a; --neon:#38bdf8; --glass-border:rgba(56,189,248,0.22);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:"Inter",sans-serif;background:linear-gradient(180deg,var(--bg-1),var(--bg-2));color:#dfffe6;}
.stage{display:flex;align-items:center;justify-content:center;height:100vh;}
.glass-card{width:380px;padding:20px;border-radius:18px;background:rgba(255,255,255,0.02);backdrop-filter:blur(10px);border:1px solid var(--glass-border);text-align:center;}
h1{font-family:"JetBrains Mono", monospace;color:var(--neon);}
form{display:flex;flex-direction:column;gap:12px;margin-top:16px;}
input{padding:10px;border-radius:6px;border:1px solid var(--glass-border);background:rgba(255,255,255,0.02);color:#dfffe6;}
input[type=submit]{background:var(--neon);color:#020617;font-weight:bold;cursor:pointer;}
input[type=submit]:hover{opacity:0.9;}
.switch{margin-top:10px;font-size:14px;color:var(--neon);cursor:pointer;}
</style>
</head>
<body>
<main class="stage">
<section class="glass-card">
<h1>ROK XD</h1>
<form id="loginForm">
<input type="text" name="username" placeholder="Nom d'utilisateur" style="display:none;">
<input type="email" name="email" placeholder="Email" required>
<input type="password" name="password" placeholder="Mot de passe" required>
<input type="submit" value="Se connecter">
</form>
<div class="switch" id="switchForm">Pas de compte ? Inscris-toi</div>
</section>
</main>
<script>
let isRegister = false;
const form = document.getElementById('loginForm');
const switchBtn = document.getElementById('switchForm');
const usernameInput = form.username;

switchBtn.addEventListener('click',()=>{
  isRegister = !isRegister;
  usernameInput.style.display = isRegister ? 'block' : 'none';
  form.querySelector('input[type=submit]').value = isRegister ? "S'inscrire" : "Se connecter";
  switchBtn.innerText = isRegister ? "Déjà un compte ? Connexion" : "Pas de compte ? Inscris-toi";
});

form.addEventListener('submit', async e=>{
  e.preventDefault();
  const data = {
    email: form.email.value.trim(),
    password: form.password.value.trim()
  };
  if(isRegister) data.username = form.username.value.trim();

  try{
    const endpoint = isRegister ? '/api/register' : '/api/login';
    const res = await fetch(endpoint,{
      method:'POST',
      headers:{'Content-Type':'application/json','x-api-key':'demo-key'},
      body: JSON.stringify(data)
    });
    const result = await res.json();
    alert(result.message+(result.coins? ` | Coins: ${result.coins}` : ''));
    if(res.ok){
      localStorage.setItem('username', isRegister ? data.username : result.username);
      window.location.href='/';
    }
  }catch(err){alert('Erreur serveur'); console.error(err);}
});
</script>
</body>
</html>
