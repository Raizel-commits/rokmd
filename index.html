<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROK XD • WhatsApp Bot</title>

<style>
:root{
  --bg1:#020617; --bg2:#0f172a; --neon:#38bdf8;
  --glass:rgba(56,189,248,.22); --muted:rgba(255,255,255,.5);
}
*{box-sizing:border-box}
body{
  margin:0; min-height:100vh;
  font-family:Inter,system-ui;
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  color:#dfffe6; display:flex; justify-content:center; align-items:center;
}
.card{
  width:400px; max-width:95%;
  background:rgba(255,255,255,.02);
  border:1px solid var(--glass);
  border-radius:18px;
  padding:22px;
  box-shadow:0 10px 40px #000;
  text-align:center;
}
h1{margin:0;color:var(--neon)}
.btn{
  width:100%; padding:12px; margin:8px 0;
  background:var(--neon); color:#020617;
  border:none; border-radius:8px;
  font-weight:bold; cursor:pointer;
}
select,input{
  width:100%; padding:8px;
  margin:6px 0;
  background:#020617; color:#fff;
  border:1px solid var(--glass);
  border-radius:6px;
}
.small{font-size:13px;color:var(--muted)}
.store{margin-top:15px}
.store div{
  padding:10px; margin:6px 0;
  border:1px solid var(--glass);
  border-radius:10px;
  cursor:pointer;
}
.store div:hover{background:rgba(56,189,248,.1)}
.result{margin-top:10px;font-weight:bold}
</style>
</head>

<body>
<div class="card">

<h1>ROK XD</h1>
<div class="small">WhatsApp Bot</div>

<hr style="border-color:var(--glass)">

<div><b>Coins :</b> <span id="coins">0</span></div>
<div class="small" id="timer">Bot inactif</div>

<!-- BOT STORE -->
<div class="store">
  <div onclick="buyBot(24)">24h – 20 coins</div>
  <div onclick="buyBot(48)">48h – 40 coins</div>
  <div onclick="buyBot(72)">72h – 60 coins</div>
</div>

<hr style="border-color:var(--glass)">

<!-- MONEY FUSION -->
<h3>Achat Coins</h3>

<form id="depositForm">
  <select id="amount" required>
    <option value="">Choisir montant</option>
    <option value="250">250 F → 20 coins</option>
    <option value="500">500 F → 40 coins</option>
    <option value="750">750 F → 60 coins</option>
    <option value="1000">1000 F → 80 coins</option>
    <option value="1500">1500 F → 120 coins</option>
    <option value="2000">2000 F → 160 coins</option>
  </select>

  <input type="tel" id="phoneNumber" placeholder="+2376XXXXXXXX" required>
  <input type="text" id="accountName" placeholder="Nom du titulaire" required>

  <button class="btn">Payer avec Mobile Money</button>
</form>

<div class="result" id="result"></div>

<hr style="border-color:var(--glass)">

<a href="/pair" class="btn">PAIRING</a>
<a href="/qrpage" class="btn">QR CODE</a>

</div>

<script>
const coinsEl = document.getElementById("coins");
const timerEl = document.getElementById("timer");
const result = document.getElementById("result");

async function loadCoins(){
  const r = await fetch("/coins");
  const d = await r.json();
  coinsEl.textContent = d.coins;
  if(d.botActiveRemaining>0){
    setInterval(()=>{
      const t=d.botActiveRemaining-Date.now();
      if(t<=0) timerEl.textContent="Bot inactif";
    },1000);
  }
}
loadCoins();

async function buyBot(h){
  if(!confirm("Confirmer achat "+h+"h ?")) return;
  const r = await fetch("/buy-bot",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({duration:h})
  });
  const d = await r.json();
  result.textContent = d.error || d.status;
  loadCoins();
}

document.getElementById("depositForm").onsubmit = async e=>{
  e.preventDefault();
  result.textContent="Paiement en cours...";
  const r = await fetch("/deposit",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      amount:amount.value,
      phoneNumber:phoneNumber.value,
      accountName:accountName.value
    })
  });
  const d = await r.json();
  result.textContent = d.error || "Confirme le paiement sur ton téléphone";
};
</script>

</body>
</html>
