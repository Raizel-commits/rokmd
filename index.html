<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROK XD • WhatsApp Bot</title>
<style>
:root{
  --bg-1:#020617;
  --bg-2:#0f172a;
  --neon:#38bdf8;
  --glass-border:rgba(56,189,248,0.22);
  --muted:rgba(255,255,255,0.45);
  --card-w:400px;
}
*{box-sizing:border-box;}
html,body{
  height:100%;
  margin:0;
  font-family:"Inter",system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  background: radial-gradient(1200px 600px at 10% 10%, rgba(56,189,248,0.03), transparent),
              radial-gradient(900px 500px at 90% 85%, rgba(56,189,248,0.02), transparent),
              linear-gradient(180deg,var(--bg-1),var(--bg-2));
  color:#dfffe6;
  overflow-x:hidden;
}
.stage{
  position:relative;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:36px;
}
.glass-card{
  width:var(--card-w);
  max-width:95vw;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius:18px;
  padding:22px;
  box-shadow:0 10px 40px rgba(0,0,0,0.7),0 0 40px rgba(56,189,248,0.05) inset;
  backdrop-filter: blur(12px) saturate(150%);
  border:1px solid var(--glass-border);
  text-align:center;
  position:relative;
  transition:0.3s;
}
.glass-card:hover{transform:translateY(-4px);}
.card-header h1{
  font-family:"JetBrains Mono", monospace;
  font-size:26px;
  margin:0;
  color:var(--neon);
  text-transform:uppercase;
  text-shadow:0 0 18px rgba(56,189,248,0.22);
}
.card-header .small-url{font-size:12px;color:var(--muted);margin-top:6px;}
.btn{
  display:block;
  width:100%;
  padding:12px;
  margin:10px 0;
  font-size:16px;
  font-weight:bold;
  color:#020617;
  background:var(--neon);
  border:none;
  border-radius:8px;
  text-decoration:none;
  cursor:pointer;
  text-align:center;
  transition:0.2s;
}
.btn:hover{opacity:0.9;transform:scale(1.03);}
.social-icons{
  display:flex;
  justify-content:center;
  gap:15px;
  margin-top:15px;
}
.social-icons a{
  display:flex;
  align-items:center;
  justify-content:center;
  width:40px;
  height:40px;
  border-radius:50%;
  background:var(--neon);
  color:#020617;
  text-decoration:none;
  font-weight:bold;
  font-size:20px;
  transition:0.2s;
}
.social-icons a:hover{transform:scale(1.1);}
.credits{font-size:12px;color:var(--muted);margin-top:20px;}
.avatar{margin-bottom:10px;}
.avatar img{width:60px;height:60px;border-radius:50%;border:2px solid var(--neon);}
.coins-display{display:flex;justify-content:center;align-items:center;gap:8px;margin-bottom:15px;font-weight:bold;}
.coins-display button{width:auto;padding:4px 8px;font-size:14px;}
.timer{margin-top:8px;font-size:14px;color:#38bdf8;font-weight:bold;}
.store{display:flex;flex-direction:column;gap:12px;margin:15px 0;}
.store-card{
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.006));
  border:1px solid var(--glass-border);
  border-radius:15px;
  padding:15px;
  text-align:center;
  cursor:pointer;
  transition:0.2s;
}
.store-card:hover{
  box-shadow:0 0 20px var(--neon),0 0 40px rgba(56,189,248,0.15) inset;
  transform:scale(1.03);
}
.store-card h3{margin:0;color:#38bdf8;font-size:18px;font-weight:bold;}
.store-card p{margin:6px 0;font-size:14px;color:var(--muted);}
.store-card .price{margin-top:8px;font-weight:bold;color:#38bdf8;font-size:16px;}
.deposit-form{display:none;flex-direction:column;gap:8px;margin:12px 0;}
.deposit-form label{font-size:14px;color:#dfffe6;font-weight:bold;text-align:left;}
.deposit-form input, .deposit-form select{padding:6px 10px;border-radius:6px;border:1px solid var(--glass-border);background:rgba(255,255,255,0.02);color:#dfffe6;font-size:14px;}
.deposit-form button{margin-top:8px;}
#instructions{background:rgba(56,189,248,0.05);padding:8px;border-radius:6px;font-size:14px;color:#dfffe6;}
</style>
</head>
<body>
<main class="stage">
<section class="glass-card">
  <div class="avatar">
    <img src="https://files.catbox.moe/36ywf8.jpeg" alt="Avatar">
  </div>

  <header class="card-header">
    <h1>ROK XD</h1>
    <div class="small-url">WhatsApp Bot</div>
  </header>

  <div class="coins-display">
    Coins : <span id="coins">0</span>
    <button id="addCoinsBtn">+</button>
  </div>

  <div class="timer" id="botTimer">Bot inactif</div>

  <div class="store">
    <div class="store-card" onclick="activateBot(24)">
      <h3>24 heures</h3>
      <p>Activation du bot pendant 24h</p>
      <div class="price">20 coins</div>
    </div>
    <div class="store-card" onclick="activateBot(48)">
      <h3>48 heures</h3>
      <p>Activation du bot pendant 48h</p>
      <div class="price">40 coins</div>
    </div>
    <div class="store-card" onclick="activateBot(72)">
      <h3>72 heures</h3>
      <p>Activation du bot pendant 72h</p>
      <div class="price">60 coins</div>
    </div>
  </div>

  <div class="store">
    <h3>Achat de Coins via Mobile Money</h3>
    <form id="depositForm" class="deposit-form">
      <label>Montant (F CFA):</label>
      <select id="amount" required>
        <option value="">--Choisir--</option>
        <option value="50">50 F → 4 coins</option>
        <option value="100">100 F → 8 coins</option>
        <option value="250">250 F → 20 coins</option>
        <option value="500">500 F → 40 coins</option>
        <option value="750">750 F → 60 coins</option>
        <option value="1000">1000 F → 80 coins</option>
      </select>
      <label>Opérateur:</label>
      <select id="operator" required>
        <option value="">--Choisir--</option>
        <option value="MTN Money">MTN Money</option>
        <option value="Orange Money">Orange Money</option>
      </select>
      <label>Numéro:</label>
      <input type="tel" id="phoneNumber" placeholder="+237 6XX XXX XXX" required>
      <label>Nom titulaire:</label>
      <input type="text" id="accountName" placeholder="Nom complet" required>
      <button type="submit" class="btn">Acheter Coins</button>
      <div id="depositResult"></div>
    </form>
  </div>

  <div class="social-icons">
    <a href="https://t.me/devraizel" target="_blank">T</a>
    <a href="https://wa.me/237673941535" target="_blank">W</a>
  </div>
  <div class="credits">Développé par RAIZEL & KNUT</div>
</section>
</main>

<script>
const coinsEl = document.getElementById("coins");
const botTimer = document.getElementById("botTimer");
const depositForm = document.getElementById("depositForm");
const addCoinsBtn = document.getElementById("addCoinsBtn");

let botTimeRemaining = 0;

// Charger coins et bot timer depuis le serveur
async function loadUserData() {
  try {
    const res = await fetch("/coins");
    const data = await res.json();
    coinsEl.textContent = data.coins;
    botTimeRemaining = data.botActiveRemaining;
    startTimer();
  } catch (err) {
    console.error(err);
  }
}
loadUserData();

function startTimer(){
  if(botTimeRemaining<=0){ botTimer.textContent="Bot inactif"; return; }
  const interval = setInterval(()=>{
    if(botTimeRemaining<=0){ botTimer.textContent="Bot inactif"; clearInterval(interval); return; }
    botTimeRemaining-=1000;
    const h = Math.floor(botTimeRemaining/3600000);
    const m = Math.floor((botTimeRemaining%3600000)/60000);
    const s = Math.floor((botTimeRemaining%60000)/1000);
    botTimer.textContent = `Bot actif : ${h}h ${m}m ${s}s`;
  },1000);
}

// Affiche formulaire Mobile Money
addCoinsBtn.onclick = () => depositForm.style.display = depositForm.style.display==='flex'?'none':'flex';

// Activation Bot
function activateBot(hours){
  if(confirm(`Confirmez l'activation du bot pour ${hours} heures ?`)){
    fetch("/buy-bot", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({duration: hours})
    })
    .then(r=>r.json())
    .then(d=>{
      if(d.error) return alert(d.error);
      alert(d.status);
      loadUserData();
    });
  }
}

// Paiement Mobile Money via serveur
depositForm.addEventListener("submit", async (e)=>{
  e.preventDefault();
  const amount = document.getElementById("amount").value;
  const operator = document.getElementById("operator").value;
  const phone = document.getElementById("phoneNumber").value;
  const name = document.getElementById("accountName").value;

  if(!amount || !operator || !phone || !name) return alert("Tous les champs sont requis !");
  try{
    const res = await fetch("/deposit", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({amount, operator, phone, name})
    });
    const data = await res.json();
    if(data.paymentUrl){
      window.location.href = data.paymentUrl;
    } else {
      alert("Erreur création paiement");
    }
  } catch(err){
    console.error(err);
    alert("Erreur serveur");
  }
});
</script>
</body>
</html>
