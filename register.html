<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Register • ROK XD</title>

<script src="https://www.google.com/recaptcha/api.js" async defer></script>

<style>
body{
  margin:0;height:100vh;display:flex;justify-content:center;align-items:center;
  background:#020617;color:#e5e7eb;font-family:Arial;
}
.card{
  width:360px;padding:24px;border-radius:16px;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(56,189,248,.3);
  text-align:center;
}
input,button{
  width:100%;padding:10px;margin:8px 0;border-radius:6px;border:none;
}
button{background:#38bdf8;color:#020617;font-weight:bold;cursor:pointer}
.small{font-size:12px;color:#aaa}
</style>
</head>

<body>
<div class="card">
  <h2>Créer un compte</h2>

  <form id="registerForm">
    <input name="username" placeholder="Nom d'utilisateur" required>
    <input type="email" name="email" placeholder="Email" required>
    <input type="password" name="password" placeholder="Mot de passe" required>

    <div class="g-recaptcha" data-sitekey="6Ld6ojosAAAAAB8xEXwZGXPgPmAoFsG_bJQWFq_A"></div>

    <button>S'inscrire</button>
  </form>

  <p class="small" id="msg"></p>
  <p class="small"><a href="/">Déjà inscrit ? Connexion</a></p>
</div>

<script>
document.getElementById('registerForm').addEventListener('submit', async e => {
  e.preventDefault();
  const recaptcha = grecaptcha.getResponse();
  if(!recaptcha) return alert("Valide le CAPTCHA");

  const data = {
    username: e.target.username.value,
    email: e.target.email.value,
    password: e.target.password.value,
    recaptcha
  };

  const res = await fetch('/auth/register',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(data)
  });

  const r = await res.json();
  document.getElementById('msg').innerText = r.message;

  if(r.message.includes("succès")) {
    setTimeout(()=>location.href='/',1200);
  }
});
</script>
</body>
</html>
